webpackJsonp([9],{"+/y+":function(e,t){},ZH1b:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),r=a.n(n),s=a("exGp"),o=a.n(s),i=a("bBUo"),l=a("i84Q"),c=a("E8ny"),u={data:function(){return{tableData:[],totalCount:0,offset:0,city:null,showDialog:!1,form:{},baseUrl:c.b,baseImgPath:c.a,options:[],selectedOption:[]}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(l.u)();case 2:return 1===(a=t.sent).status&&(e.totalCount=a.count),t.next=6,Object(l.j)();case 6:e.city=t.sent,e.getShops();case 8:case"end":return t.stop()}},t,e)}))()},getShops:function(){var e=this;return o()(r.a.mark(function t(){var a,n,s,o;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.tableData=[],a=e.city,n=a.latitude,s=a.longitude,t.next=4,Object(l.w)({latitude:n,longitude:s,offset:e.offset});case 4:(o=t.sent)instanceof Array?o.forEach(function(t){var a={};a.name=t.name,a.address=t.address,a.description=t.description,a.id=t.id,a.phone=t.phone,a.rating=t.rating,a.recent_order_num=t.recent_order_num,a.category=t.category,a.image_path=t.image_path,e.tableData.push(a)}):console.log("获取商家列表失败!");case 6:case"end":return t.stop()}},t,e)}))()},handleCurrentChange:function(e){this.offset=20*(e-1),this.getShops()},handleEdit:function(e,t){this.showDialog=!0,this.form=t,this.selectedOption=t.category.split("/"),this.options.length||this.getCategory()},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<1.5;return t?a?void 0:(this.$message({type:"error",message:"上传头像图片大小不能超过1.5MB!"}),!1):(this.$message({type:"error",message:"上传头像图片只能是 JPG 格式!"}),!1)},uploadSuccess:function(e){1===e.status?this.form.image_path=e.image_path:this.$message.error("上传头像失败!")},getCategory:function(){var e=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(l.i)();case 2:t.sent.forEach(function(t){var a={value:t.name,label:t.name};t.sub_categories.length&&(a.children=[],t.sub_categories.forEach(function(e,t){0!==t&&a.children.push({value:e.name,label:e.name})})),e.options.push(a)});case 4:case"end":return t.stop()}},t,e)}))()},querySearch:function(e,t){var a=this;return o()(r.a.mark(function n(){var s;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(""===e){n.next=5;break}return n.next=3,Object(l.e)({city_id:a.city.id,keyword:e});case 3:(s=n.sent)instanceof Array&&(s.map(function(e){return e.value=e.address,e}),t(s));case 5:case"end":return n.stop()}},n,a)}))()},updateShop:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.showDialog=!1,e.form.category=e.selectedOption.join("/"),t.prev=2,t.next=5,Object(l.C)(e.form);case 5:1===(a=t.sent).status?(e.$message({type:"success",message:"更新店铺信息成功"}),e.getShops()):e.$message({type:"error",message:a.message}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log("更新店铺信息失败",t.t0);case 12:case"end":return t.stop()}},t,e,[[2,9]])}))()},addFood:function(e,t){this.$router.push({path:"/manage/addfood",query:{restaurant_id:t.id}})},handleDelete:function(e,t){var a=this;this.$confirm("确定删除该商家吗?","提示",{confirmButtonText:"确定",cacelButtonText:"取消",type:"warning"}).then(o()(r.a.mark(function e(){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.l)(t.id);case 2:1===(n=e.sent).status?(a.$message.success("删除店铺成功！"),a.getShops()):(a.$message.error(n.message),console.log("删除店铺失败"));case 4:case"end":return e.stop()}},e,a)}))).catch(function(){a.$message.info("已取消删除")})}},components:{headTop:i.a}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"shoplist"}},[a("head-top"),e._v(" "),a("div",{staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"form",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"店铺名称"}},[a("span",[e._v(e._s(t.row.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"店铺地址"}},[a("span",[e._v(e._s(t.row.address))])]),e._v(" "),a("el-form-item",{attrs:{label:"店铺介绍"}},[a("span",[e._v(e._s(t.row.description))])]),e._v(" "),a("el-form-item",{attrs:{label:"店铺 ID"}},[a("span",[e._v(e._s(t.row.id))])]),e._v(" "),a("el-form-item",{attrs:{label:"联系电话"}},[a("span",[e._v(e._s(t.row.phone))])]),e._v(" "),a("el-form-item",{attrs:{label:"评分"}},[a("span",[e._v(e._s(t.row.rating))])]),e._v(" "),a("el-form-item",{attrs:{label:"销售量"}},[a("span",[e._v(e._s(t.row.recent_order_num))])]),e._v(" "),a("el-form-item",{attrs:{label:"分类"}},[a("span",[e._v(e._s(t.row.category))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"name",label:"店铺名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{property:"address",label:"店铺地址",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{property:"description",label:"店铺介绍",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"5px"},attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticStyle:{padding:"5px"},attrs:{size:"mini",type:"success"},on:{click:function(a){return e.addFood(t.$index,t.row)}}},[e._v("添加食品")]),e._v(" "),a("el-button",{staticStyle:{padding:"5px"},attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-left":"40px","margin-bottom":"40px"},attrs:{background:"",layout:"prev, pager, next, total","page-size":20,total:e.totalCount},on:{"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:"修改店铺信息",visible:e.showDialog,"modal-append-to-body":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",{attrs:{model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"店铺名称"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"详细地址"}},[a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearch,"trigger-on-focus":!1,placeholder:"请输入地址"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}}),e._v(" "),a("span",[e._v("当前城市：广州")])],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺介绍"}},[a("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话"}},[a("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺分类"}},[a("el-cascader",{attrs:{options:e.options,"change-on-select":""},model:{value:e.selectedOption,callback:function(t){e.selectedOption=t},expression:"selectedOption"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商铺图片"}},[a("el-upload",{staticClass:"upload",attrs:{action:e.baseUrl+"/v1/addimg/shop","before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"show-file-list":!1}},[e.form.image_path?a("img",{staticClass:"avatar",attrs:{src:e.baseImgPath+e.form.image_path}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updateShop}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(u,p,!1,function(e){a("+/y+")},"data-v-1ee3c6d0",null);t.default=d.exports}});
//# sourceMappingURL=9.eff4fafe6817f8526eb6.js.map