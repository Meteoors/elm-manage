webpackJsonp([3],{BlOq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),o=a.n(r),s=a("exGp"),i=a.n(s),n=a("bBUo"),l=a("E8ny"),c=a("i84Q"),m={data:function(){return{baseUrl:l.b,baseImgPath:l.a,form:{name:"",address:"",phone:null,description:"",promotion_info:"",category:"",is_premium:!0,delivery_mode:!0,new:!0,bao:!0,zhun:!0,piao:!0,float_delivery_fee:5,float_minimum_order_amount:20,startTime:"",endTime:"",image_path:"",business_license_image:"",catering_service_license_image:"",activities:[],latitude:"",longitude:""},city:null,cascaders:[],category:["快餐便当","简餐"],selectedIndex:0,options:[{name:"满减优惠",icon_name:"减"},{name:"优惠大酬宾",icon_name:"特"},{name:"新用户立减",icon_name:"新"},{name:"进店领券",icon_name:"领"}],rules:{name:[{required:!0,message:"请输入店铺名称"}],address:[{required:!0,message:"请输入详细地址"}],phone:[{required:!0,message:"请输入联系电话",trigger:"change"},{type:"number",message:"电话号码必须是数字",trigger:"change"}]},tableData:[{icon_name:"减",name:"满减优惠",description:"满30减5，满60减8"}],showDialog:!1,description:""}},mounted:function(){this.initData()},components:{headTop:n.a},methods:{initData:function(){var e=this;return i()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.getCity(),e.getCategory();case 2:case"end":return t.stop()}},t,e)}))()},getCity:function(){var e=this;return i()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c.j)();case 3:a=t.sent,e.city={name:a.name,id:a.id},t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("定位当前城市失败",t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},getCategory:function(){var e=this;return i()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(c.i)();case 3:(a=t.sent)instanceof Array&&a.forEach(function(t){var a={value:t.name,label:t.name,children:[]};t.sub_categories.forEach(function(e,t){0!==t&&a.children.push({value:e.name,label:e.name})}),e.cascaders.push(a)}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("获取商家分类列表失败",t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},querySearch:function(e,t){var a=this;return i()(o.a.mark(function r(){var s;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(c.e)({keyword:e,city_id:a.city.id});case 3:(s=r.sent)instanceof Array&&(s.map(function(e){return e.value=e.address,e}),t(s)),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.log("获取地址列表失败",r.t0);case 10:case"end":return r.stop()}},r,a,[[0,7]])}))()},chooseAddress:function(e){this.form.latitude=e.latitude,this.form.longitude=e.longitude},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<1.5;return t?a?void 0:(this.$message.error("上传图片大小不能超过1.5MB！"),!1):(this.$message.error("上传图片只能是 JPG 格式!"),!1)},uploadSuccess:function(e,t){1===e.status?this.form[t]=e.image_path:this.$message.error("图片上传失败!")},handleSelect:function(){this.showDialog=!0},handleDelete:function(e){this.tableData.splice(e,1)},addActivity:function(){if(this.showDialog=!1,""===this.description)this.$message.warning("请输入活动详情");else{var e=this.options[this.selectedIndex];this.tableData.push({icon_name:e.icon_name,name:e.name,description:this.description}),this.description=""}},addShop:function(){var e=this;return i()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.form.validate(function(){var t=i()(o.a.mark(function t(a){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=9;break}return e.form.category=e.category.join("/"),e.form.activities=e.tableData,t.next=5,Object(c.c)(e.form);case 5:1===(r=t.sent).status?(e.$message.success("商铺添加成功"),e.category=[],e.form.is_premium=e.form.delivery_mode=e.form.new=e.form.bao=e.form.zhun=e.form.piao=!0,e.form.startTime=e.form.endTime="",e.selectedIndex=0,e.tableData=[{icon_name:"减",name:"满减优惠",description:"满30减5，满60减8"}],e.$refs.form.resetFields()):e.$message.error(r.message),t.next=10;break;case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"addshop"}},[a("head-top"),e._v(" "),a("el-row",{staticClass:"wrapper"},[a("el-col",{attrs:{span:13,offset:4}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"店铺名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearch,"trigger-on-focus":!1,placeholder:"请输入地址"},on:{select:e.chooseAddress},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}}),e._v(" "),e.city?a("div",{staticStyle:{"line-height":"14px","margin-top":"5px"}},[e._v("当前城市："+e._s(e.city.name))]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话",prop:"phone"}},[a("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",e._n(t))},expression:"form.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺简介",prop:"description"}},[a("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺标语",prop:"promotion_info"}},[a("el-input",{model:{value:e.form.promotion_info,callback:function(t){e.$set(e.form,"promotion_info",t)},expression:"form.promotion_info"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺分类"}},[a("el-cascader",{attrs:{options:e.cascaders},model:{value:e.category,callback:function(t){e.category=t},expression:"category"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店铺特点"}},[a("div",{staticClass:"switchs"},[a("span",[e._v("品牌保证")]),e._v(" "),a("el-switch",{model:{value:e.form.is_premium,callback:function(t){e.$set(e.form,"is_premium",t)},expression:"form.is_premium"}}),e._v(" "),a("span",[e._v("蜂鸟专送")]),e._v(" "),a("el-switch",{model:{value:e.form.delivery_mode,callback:function(t){e.$set(e.form,"delivery_mode",t)},expression:"form.delivery_mode"}}),e._v(" "),a("span",[e._v("新开店铺")]),e._v(" "),a("el-switch",{model:{value:e.form.new,callback:function(t){e.$set(e.form,"new",t)},expression:"form.new"}})],1),e._v(" "),a("div",{staticClass:"switchs"},[a("span",[e._v("外卖保")]),e._v(" "),a("el-switch",{model:{value:e.form.bao,callback:function(t){e.$set(e.form,"bao",t)},expression:"form.bao"}}),e._v(" "),a("span",[e._v("准时达")]),e._v(" "),a("el-switch",{model:{value:e.form.zhun,callback:function(t){e.$set(e.form,"zhun",t)},expression:"form.zhun"}}),e._v(" "),a("span",[e._v("开发票")]),e._v(" "),a("el-switch",{model:{value:e.form.piao,callback:function(t){e.$set(e.form,"piao",t)},expression:"form.piao"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"配送费",prop:"float_delivery_fee"}},[a("el-input-number",{attrs:{min:0,max:20},model:{value:e.form.float_delivery_fee,callback:function(t){e.$set(e.form,"float_delivery_fee",t)},expression:"form.float_delivery_fee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"起送价",prop:"float_minimum_order_amount"}},[a("el-input-number",{attrs:{min:0,max:100},model:{value:e.form.float_minimum_order_amount,callback:function(t){e.$set(e.form,"float_minimum_order_amount",t)},expression:"form.float_minimum_order_amount"}})],1),e._v(" "),a("el-form-item",{staticClass:"time",attrs:{label:"营业时间"}},[a("el-time-select",{attrs:{placeholder:"起始时间","picker-options":{start:"5:30",step:"00:15",end:"23:30"}},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}}),e._v(" "),a("el-time-select",{attrs:{placeholder:"结束时间","picker-options":{start:"5:30",step:"00:15",end:"23:30"}},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传店铺头像",prop:"image_path"}},[a("el-upload",{staticClass:"upload",attrs:{"show-file-list":!1,action:e.baseUrl+"/v1/addimg/shop","before-upload":e.beforeUpload,"on-success":function(t){return e.uploadSuccess(t,"image_path")}}},[e.form.image_path?a("img",{staticClass:"image",attrs:{src:e.baseImgPath+e.form.image_path}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"上传营业执照",prop:"business_license_image"}},[a("el-upload",{staticClass:"upload",attrs:{"show-file-list":!1,action:e.baseUrl+"/v1/addimg/shop","before-upload":e.beforeUpload,"on-success":function(t){return e.uploadSuccess(t,"business_license_image")}}},[e.form.business_license_image?a("img",{staticClass:"image",attrs:{src:e.baseImgPath+e.form.business_license_image}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"上传餐饮服务许可证",prop:"catering_service_license_image"}},[a("el-upload",{staticClass:"upload",attrs:{"show-file-list":!1,action:e.baseUrl+"/v1/addimg/shop","before-upload":e.beforeUpload,"on-success":function(t){return e.uploadSuccess(t,"catering_service_license_image")}}},[e.form.catering_service_license_image?a("img",{staticClass:"image",attrs:{src:e.baseImgPath+e.form.catering_service_license_image}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠活动"}},[a("el-select",{on:{change:e.handleSelect},model:{value:e.selectedIndex,callback:function(t){e.selectedIndex=t},expression:"selectedIndex"}},e._l(e.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:t}})}),1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"活动标题",prop:"icon_name",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"活动名称",prop:"name",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"活动详情",prop:"description",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.handleDelete(t.$index)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-button",{staticStyle:{display:"block",margin:"20px auto"},attrs:{type:"primary",size:"medium"},on:{click:e.addShop}},[e._v("立即创建")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.showDialog,title:"提示","modal-append-to-body":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"请输入活动详情"}},[a("el-input",{model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addActivity}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(m,u,!1,function(e){a("FbPl")},"data-v-a1790d22",null);t.default=p.exports},FbPl:function(e,t){}});
//# sourceMappingURL=3.95dc7bd7220f98ccb82b.js.map