webpackJsonp([5],{"/VPI":function(e,t){},kpLm:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),s=a.n(r),o=a("Xxa5"),i=a.n(o),n=a("exGp"),l=a.n(n),c=a("bBUo"),p=a("i84Q"),m=a("E8ny"),u={data:function(){return{form:{category_id:null,restaurant_id:null,name:"",image_path:"",specs:[{specs:"默认",packing_fee:0,price:20}],description:"",activity:"",attributes:[]},categoryForm:{name:"",description:"",restaurant_id:null},specTable:[{specs:"默认",packing_fee:0,price:20}],specForm:{specs:"",packing_fee:0,price:20},options:[],attrOptions:[{label:"新品",value:"新"},{label:"招牌",value:"招牌"}],rules:{name:[{required:!0,message:"请输入食品名称",trigger:"blur"}]},specRules:{specs:[{required:!0,message:"请输入规格",trigger:"blur"}]},radio:0,showCategory:!1,showChooseShop:!1,showAddSpec:!1,restaurant_id:null,baseUrl:m.b,baseImgPath:m.a}},mounted:function(){this.initData()},components:{headTop:c.a},methods:{initData:function(){void 0!==this.$route.query.restaurant_id?(this.restaurant_id=this.form.restaurant_id=this.categoryForm.restaurant_id=this.$route.query.restaurant_id,this.getCategory()):this.showChooseShop=!0},getCategory:function(){var e=this;return l()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.options=[],t.prev=1,t.next=4,Object(p.m)(e.form.restaurant_id);case 4:if(1!==(a=t.sent).status){t.next=9;break}a.category_list.forEach(function(t){e.options.push({name:t.name,id:t.id})}),t.next=10;break;case 9:throw new Error;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),console.log("获取食品种类列表失败",t.t0);case 15:case"end":return t.stop()}},t,e,[[1,12]])}))()},addCategory:function(){var e=this;return l()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.query.restaurant_id){t.next=3;break}return e.showChooseShop=!0,t.abrupt("return");case 3:return t.next=5,Object(p.a)(e.categoryForm);case 5:1===(a=t.sent).status?(e.$message.success("添加食品种类成功"),e.getCategory(),e.$refs.categoryForm.resetFields()):e.$message.error(a.message);case 7:case"end":return t.stop()}},t,e)}))()},handleClose:function(){this.$message.warning("取消"),this.showChooseShop=!1},chooseShop:function(){this.$router.push("/manage/shoplist")},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<1.5;return t?a?void 0:(this.$message.error("上传图片大小不能超过1.5MB!"),!1):(this.$message.error("上传图片只能是 JPG 格式!"),!1)},uploadSuccess:function(e){1===e.status?this.form.image_path=e.image_path:this.$message.error("图片上传失败!")},deleteSpec:function(e){this.specTable.splice(e,1)},showSpecDialog:function(){this.showAddSpec=!0},addSpec:function(){var e=this;this.$refs.specForm.validate(function(t){if(!t)return!1;var a=s()({},e.specForm);e.specTable.push(a),e.showAddSpec=!1,e.$refs.specForm.resetFields()})},addFood:function(){var e=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.radio||e.specTable.length){t.next=3;break}return e.$message.error("至少填写一种规格"),t.abrupt("return");case 3:if(e.$route.query.restaurant_id){t.next=6;break}return e.showChooseShop=!0,t.abrupt("return");case 6:e.$refs.form.validate(function(){var t=l()(i.a.mark(function t(a){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=14;break}return e.radio&&(e.form.specs=e.specTable),t.prev=2,t.next=5,Object(p.b)(e.form);case 5:1===(r=t.sent).status?(e.$message.success("添加商品成功"),e.radio=0,e.$refs.form.resetFields(),e.form.specs=[{specs:"默认",packing_fee:0,price:20}],e.specTable=[{specs:"默认",packing_fee:0,price:20}]):e.$message.error(r.message),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log("添加商品失败",t.t0);case 12:t.next=15;break;case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}},t,e,[[2,9]])}));return function(e){return t.apply(this,arguments)}}());case 7:case"end":return t.stop()}},t,e)}))()}},watch:{$route:function(e,t){"/manage/addfood"===e.path&&this.initData()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"addfood"}},[a("head-top"),e._v(" "),a("el-row",[a("el-col",{attrs:{span:14,offset:5}},[a("header",[e._v("选择食品种类")]),e._v(" "),a("el-form",{ref:"categoryForm",staticClass:"category_from form",attrs:{"label-width":"130px",model:e.categoryForm}},[a("el-form-item",{staticClass:"category",attrs:{label:"食品种类"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},e._l(e.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("div",{staticClass:"control",class:e.showCategory?"show_control":""},[a("el-form-item",{staticClass:"name",attrs:{label:"食品种类",prop:"name"}},[a("el-input",{model:{value:e.categoryForm.name,callback:function(t){e.$set(e.categoryForm,"name",t)},expression:"categoryForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"种类描述",prop:"description"}},[a("el-input",{model:{value:e.categoryForm.description,callback:function(t){e.$set(e.categoryForm,"description",t)},expression:"categoryForm.description"}})],1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addCategory}},[e._v("提交")])],1),e._v(" "),a("div",{staticClass:"add_category",on:{click:function(t){e.showCategory=!e.showCategory}}},[a("i",{class:e.showCategory?"el-icon-caret-top":"el-icon-caret-bottom"}),e._v(" "),a("span",[e._v("添加食品种类")])])],1),e._v(" "),a("header",[e._v("添加食品")]),e._v(" "),a("el-form",{ref:"form",staticClass:"form add_form",attrs:{model:e.form,"label-width":"110px",rules:e.rules}},[a("el-form-item",{attrs:{label:"食品名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"食品活动",prop:"activity"}},[a("el-input",{model:{value:e.form.activity,callback:function(t){e.$set(e.form,"activity",t)},expression:"form.activity"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"食品详情",prop:"description"}},[a("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传食品图片",prop:"image_path"}},[a("el-upload",{staticClass:"upload",attrs:{"show-file-list":!1,action:e.baseUrl+"/v1/addimg/food","before-upload":e.beforeUpload,"on-success":e.uploadSuccess}},[e.form.image_path?a("img",{staticClass:"image",attrs:{src:e.baseImgPath+e.form.image_path}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"食品特点",prop:"attributes"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.form.attributes,callback:function(t){e.$set(e.form,"attributes",t)},expression:"form.attributes"}},e._l(e.attrOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"食品规格"}},[a("el-radio",{attrs:{label:0},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("单规格")]),e._v(" "),a("el-radio",{attrs:{label:1},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("多规格")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.radio,expression:"!radio"}],attrs:{label:"包装费"}},[a("el-input-number",{attrs:{min:0,max:100},model:{value:e.form.specs[0].packing_fee,callback:function(t){e.$set(e.form.specs[0],"packing_fee",t)},expression:"form.specs[0].packing_fee"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.radio,expression:"!radio"}],attrs:{label:"价格"}},[a("el-input-number",{attrs:{min:0,max:1e4},model:{value:e.form.specs[0].price,callback:function(t){e.$set(e.form.specs[0],"price",t)},expression:"form.specs[0].price"}})],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.radio,expression:"radio"}],staticClass:"btn",attrs:{size:"mini",type:"primary"},on:{click:e.showSpecDialog}},[e._v("添加规格")]),e._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.radio,expression:"radio"}],attrs:{data:e.specTable}},[a("el-table-column",{attrs:{label:"规格",align:"center",prop:"specs"}}),e._v(" "),a("el-table-column",{attrs:{label:"包装费",align:"center",prop:"packing_fee"}}),e._v(" "),a("el-table-column",{attrs:{label:"价格",align:"center",prop:"price"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteSpec(t.$index)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-button",{staticClass:"btn",attrs:{size:"small",type:"primary"},on:{click:e.addFood}},[e._v("确认添加食品")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.showChooseShop,title:"提示",width:"450px","before-close":e.handleClose,"modal-append-to-body":!1},on:{"update:visible":function(t){e.showChooseShop=t}}},[a("span",[e._v("添加商品需要选择一个商铺，现在就去选择商铺吗？")]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.chooseShop}},[e._v("确定")])],1)]),e._v(" "),a("el-dialog",{attrs:{visible:e.showAddSpec,title:"添加规格","modal-append-to-body":!1},on:{"update:visible":function(t){e.showAddSpec=t}}},[a("el-form",{ref:"specForm",attrs:{model:e.specForm,rules:e.specRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"规格",prop:"specs"}},[a("el-input",{model:{value:e.specForm.specs,callback:function(t){e.$set(e.specForm,"specs",t)},expression:"specForm.specs"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"包装费",prop:"packing_fee"}},[a("el-input-number",{attrs:{min:0,max:100},model:{value:e.specForm.packing_fee,callback:function(t){e.$set(e.specForm,"packing_fee",t)},expression:"specForm.packing_fee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"价格",prop:"price"}},[a("el-input-number",{attrs:{min:0,max:1e4},model:{value:e.specForm.price,callback:function(t){e.$set(e.specForm,"price",t)},expression:"specForm.price"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium"},on:{click:function(t){e.showAddSpec=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.addSpec}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,d,!1,function(e){a("/VPI")},"data-v-6edd88aa",null);t.default=f.exports}});
//# sourceMappingURL=5.6a24f220290b2d2aff2c.js.map