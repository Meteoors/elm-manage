webpackJsonp([10],{"5KJl":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),r=a("Xxa5"),o=a.n(r),l=a("exGp"),c=a.n(l),i=a("bBUo"),p=a("i84Q"),u=a("E8ny"),m={data:function(){return{tableData:[],totalCount:0,offset:0,selectTable:{},showDialog:!1,options:[],selectCategoryId:null,baseUrl:u.b,baseImgPath:u.a,showSpecDialog:!1,specForm:{specs_name:"",packing_fee:0,price:20},specRules:{specs_name:[{required:!0,message:"请输入规格",trigger:"blur"}]}}},mounted:function(){this.initData()},components:{headTop:i.a},computed:{specsTable:function(){var e=[];return this.selectTable.specfoods&&this.selectTable.specfoods.forEach(function(t){e.push({specs:t.specs_name,packing_fee:t.packing_fee,price:t.price})}),e}},methods:{initData:function(){var e=this;return c()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.n)();case 2:1===(a=t.sent).status?e.totalCount=a.count:console.log("获取食品数量失败"),e.getFoods();case 5:case"end":return t.stop()}},t,e)}))()},getFoods:function(){var e=this;return c()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.tableData=[],t.next=3,Object(p.o)(e.offset);case 3:t.sent.forEach(function(t,a){var s={};s.name=t.name,s.item_id=t.item_id,s.restaurant_id=t.restaurant_id,s.description=t.description,s.rating=t.rating,s.category_id=t.category_id,s.month_sales=t.month_sales,s.index=a,s.image_path=t.image_path,s.specfoods=t.specfoods,e.tableData.push(s)});case 5:case"end":return t.stop()}},t,e)}))()},expand:function(e,t){t.length>1&&t.shift(),1===t.length&&this.getExpandData(e)},getExpandData:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c()(o.a.mark(function s(){var r,l;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(p.v)(e.restaurant_id);case 2:r=s.sent;try{t.selectTable={restaurant_name:r.name,restaurant_address:r.address}}catch(e){console.log("获取商铺详情失败")}return s.next=6,Object(p.h)(e.category_id);case 6:l=s.sent;try{t.selectTable.category_name=l.name}catch(e){console.log("获取食品种类详情失败")}t.selectTable=n()({},t.selectTable,e),a&&t.tableData.splice(e.index,1,t.selectTable);case 10:case"end":return s.stop()}},s,t)}))()},handleEdit:function(e,t){this.showDialog=!0,this.selectCategoryId=t.category_id,this.getExpandData(t,!1),this.getCategoryOptions(t.restaurant_id)},getCategoryOptions:function(e){var t=this;return c()(o.a.mark(function a(){var s;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(p.m)(e);case 2:1===(s=a.sent).status&&s.category_list.forEach(function(e){var a={label:e.name,value:e.id};t.options.push(a)});case 4:case"end":return a.stop()}},a,t)}))()},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<1.5;return t?a?void 0:(this.$message.error("上传头像图片大小不能超过1.5MB!"),!1):(this.$message.error("上传头像图片只能是 JPG 格式!"),!1)},uploadSuccess:function(e){1===e.status?this.selectTable.image_path=e.image_path:this.$message.error("上传图片失败!")},deleteSpec:function(e,t){this.selectTable.specfoods.splice(e,1)},addSpec:function(){var e=this;this.$refs.specForm.validate(function(t){t&&(e.showSpecDialog=!1,e.selectTable.specfoods.push(n()({},e.specForm)),e.specForm.specs_name="",e.specForm.packing_fee=0,e.specForm.price=20)})},update:function(){var e=this;return c()(o.a.mark(function t(){var a,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.showDialog=!1,a=e.selectTable,t.prev=2,t.next=5,Object(p.B)({item_id:a.item_id,name:a.name,description:a.description,image_path:a.image_path,category_id:a.category_id,new_category_id:e.selectCategoryId,specs:e.specsTable});case 5:1===(s=t.sent).status?(e.$message.success(s.success),e.getFoods()):e.$message.error(s.message),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log("更新食品信息失败",t.t0);case 12:case"end":return t.stop()}},t,e,[[2,9]])}))()},handleDelete:function(e,t){var a=this;this.$confirm("确定要删除该食品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(c()(o.a.mark(function e(){var s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(p.k)(t.item_id);case 3:1===(s=e.sent).status?(a.$message.success("删除食品成功"),a.getFoods()):a.$message.error(s.message),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("删除食品失败",e.t0);case 10:case"end":return e.stop()}},e,a,[[0,7]])}))).catch(function(){a.$message.info("已取消删除")})},handleCurrentChange:function(e){this.offset=20*(e-1),this.getFoods()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"foodlist"}},[a("head-top"),e._v(" "),a("div",{staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":function(e){return e.index}},on:{"expand-change":e.expand}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"form",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"食品名称"}},[a("span",[e._v(e._s(t.row.name))])]),e._v(" "),a("el-form-item",{attrs:{label:"餐馆名称"}},[a("span",[e._v(e._s(t.row.restaurant_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"食品 ID"}},[a("span",[e._v(e._s(t.row.item_id))])]),e._v(" "),a("el-form-item",{attrs:{label:"餐馆 ID"}},[a("span",[e._v(e._s(t.row.restaurant_id))])]),e._v(" "),a("el-form-item",{attrs:{label:"食品介绍"}},[a("span",[e._v(e._s(t.row.description))])]),e._v(" "),a("el-form-item",{attrs:{label:"餐馆地址"}},[a("span",[e._v(e._s(t.row.restaurant_address))])]),e._v(" "),a("el-form-item",{attrs:{label:"食品评分"}},[a("span",[e._v(e._s(t.row.rating))])]),e._v(" "),a("el-form-item",{attrs:{label:"食品分类"}},[a("span",[e._v(e._s(t.row.category_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"月销量"}},[a("span",[e._v(e._s(t.row.month_sales))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"食品名称",prop:"name",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"食品介绍",prop:"description",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"评分",prop:"rating",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-bottom":"40px","margin-left":"40px"},attrs:{total:e.totalCount,"page-size":20,background:"",layout:"prev, pager, next, total"},on:{"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:"修改食品信息",visible:e.showDialog,"modal-append-to-body":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",{attrs:{model:e.selectTable,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"食品名称"}},[a("el-input",{model:{value:e.selectTable.name,callback:function(t){e.$set(e.selectTable,"name",t)},expression:"selectTable.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"食品介绍"}},[a("el-input",{model:{value:e.selectTable.description,callback:function(t){e.$set(e.selectTable,"description",t)},expression:"selectTable.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"食品分类"}},[a("el-select",{model:{value:e.selectCategoryId,callback:function(t){e.selectCategoryId=t},expression:"selectCategoryId"}},e._l(e.options,function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})}),1)],1),e._v(" "),a("el-form-item",[a("el-upload",{staticClass:"upload",attrs:{action:e.baseUrl+"/v1/addimg/food","on-success":e.uploadSuccess,"before-upload":e.beforeUpload,"show-file-list":!1}},[e.selectTable.image_path?a("img",{staticClass:"avatar",attrs:{src:e.baseImgPath+e.selectTable.image_path}}):a("i",{staticClass:"el-icon-plus upload-icon"})])],1)],1),e._v(" "),a("el-table",{staticStyle:{"margin-bottom":"20px"},attrs:{data:e.specsTable}},[a("el-table-column",{attrs:{align:"center",label:"规格",prop:"specs"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"包装费",prop:"packing_fee"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"价格",prop:"price"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteSpec(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-button",{staticStyle:{display:"block",margin:"0 auto"},attrs:{type:"primary"},on:{click:function(t){e.showSpecDialog=!0}}},[e._v("添加规格")]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.showDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.update}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.showSpecDialog,title:"添加规格","modal-append-to-body":!1},on:{"update:visible":function(t){e.showSpecDialog=t}}},[a("el-form",{ref:"specForm",attrs:{model:e.specForm,rules:e.specRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"规格",prop:"specs_name"}},[a("el-input",{model:{value:e.specForm.specs_name,callback:function(t){e.$set(e.specForm,"specs_name",t)},expression:"specForm.specs_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"包装费"}},[a("el-input-number",{attrs:{min:0,max:100},model:{value:e.specForm.packing_fee,callback:function(t){e.$set(e.specForm,"packing_fee",t)},expression:"specForm.packing_fee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"价格"}},[a("el-input-number",{attrs:{min:0,max:1e4},model:{value:e.specForm.price,callback:function(t){e.$set(e.specForm,"price",t)},expression:"specForm.price"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.showSpecDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addSpec}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(m,d,!1,function(e){a("O1MN")},"data-v-0b967f2c",null);t.default=f.exports},O1MN:function(e,t){}});
//# sourceMappingURL=10.ee0f123735d6ebb2dc56.js.map